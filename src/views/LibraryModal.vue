<template>
  <div v-if="show" class="library-modal-overlay" @click="closeModal">
    <div class="library-modal" @click.stop>
      <button class="modal-close" @click="closeModal">âœ•</button>

      <div class="modal-header">
        <h2>ğŸ“š è¥¿å—äº¤é€šå¤§å­¦å›¾ä¹¦é¦†</h2>
        <div class="tab-container">
          <div
            class="tab-item"
            :class="{ active: activeTab === 'rules' }"
            @click="handleTabSwitch('rules')"
          >
            å›¾ä¹¦é¦†ä½¿ç”¨è§„åˆ™
          </div>
          <div
            class="tab-item"
            :class="{ active: activeTab === 'data' }"
            @click="handleTabSwitch('data')"
          >
            æ•°æ®å¯è§†åŒ–å¤§å±
          </div>
          <div
            class="tab-item"
            :class="{ active: activeTab === 'booking' }"
            @click="handleTabSwitch('booking')"
          >
            è‡ªä¹ å®¤é¢„çº¦
          </div>
        </div>
      </div>

      <div class="modal-body">
        <!-- ä½¿ç”¨è§„åˆ™ -->
        <div v-if="activeTab === 'rules'">
          <!-- 1. å›¾ä¹¦é¦†ä½¿ç”¨è§„åˆ™ï¼ˆå®Œæ•´ä¿ç•™åŸåŠŸèƒ½ï¼Œè¡¥å……ç»†èŠ‚ï¼‰ -->
          <div v-if="activeTab === 'rules'">
            <div class="info-section">
              <h3>åŸºæœ¬ä¿¡æ¯</h3>
              <div class="info-item">
                <span class="label">ğŸ“ ä½ç½®ï¼š</span>
                <span>æ ¡å›­ä¸­å¿ƒåŒºï¼ˆè¿‘ç¬¬ä¸€æ•™å­¦æ¥¼ï¼Œä»åŒ—é—¨æ­¥è¡Œçº¦8åˆ†é’Ÿï¼‰</span>
              </div>
              <div class="info-item">
                <span class="label">â° å¼€æ”¾æ—¶é—´ï¼š</span>
                <span
                  >å‘¨ä¸€è‡³å‘¨äº” 8:00-22:00 | å‘¨æœ«
                  9:00-20:00ï¼ˆæ³•å®šèŠ‚å‡æ—¥è§å…¬å‘Šï¼‰</span
                >
              </div>
              <div class="info-item">
                <span class="label">ğŸ“ è”ç³»ç”µè¯ï¼š</span>
                <span>æœåŠ¡å° 028-66366888 | æŠ€æœ¯æ”¯æŒ 028-66366999</span>
              </div>
            </div>

            <div class="info-section">
              <h3>å€Ÿé˜…è§„åˆ™</h3>
              <ul class="facilities-list">
                <li>
                  ğŸ“š å€Ÿé˜…é¢åº¦ï¼šæœ¬ç§‘ç”Ÿ10å†Œ/30å¤©ï¼Œç ”ç©¶ç”Ÿ20å†Œ/60å¤©ï¼Œæ•™å¸ˆ30å†Œ/90å¤©
                </li>
                <li>
                  ğŸ”„
                  ç»­å€Ÿè§„åˆ™ï¼šå¯ç»­å€Ÿ1æ¬¡ï¼ˆç»­å€ŸæœŸé™åŒé¦–å€Ÿï¼‰ï¼Œéœ€åœ¨åˆ°æœŸå‰3å¤©é€šè¿‡APP/å®˜ç½‘æ“ä½œ
                </li>
                <li>
                  âš ï¸
                  é€¾æœŸå¤„ç½šï¼šæ¯å†Œæ¯å¤©0.1å…ƒï¼Œç´¯è®¡è¶…30å¤©æš‚åœå€Ÿé˜…æƒé™1å‘¨ï¼Œè¶…60å¤©åˆ—å…¥é»‘åå•
                </li>
                <li>
                  ğŸ”
                  é¢„çº¦æœåŠ¡ï¼šçƒ­é—¨å›¾ä¹¦å¯åœ¨çº¿é¢„çº¦ï¼Œåˆ°é¦†åä¿ç•™3å¤©å–ä¹¦æ—¶é—´ï¼ˆçŸ­ä¿¡é€šçŸ¥ï¼‰
                </li>
                <li>
                  ğŸ“–
                  ç‰¹æ®Šæ–‡çŒ®ï¼šå¤ç±ã€å­¤æœ¬ã€ç‰¹è—å›¾ä¹¦ä»…é™é¦†å†…é˜…è§ˆï¼Œä¸å¯å¤–å€Ÿï¼ˆéœ€ç™»è®°èº«ä»½è¯ï¼‰
                </li>
              </ul>
            </div>

            <div class="info-section">
              <h3>è‡ªä¹ åŒºä½¿ç”¨è§„åˆ™</h3>
              <ul class="facilities-list">
                <li>
                  ğŸª‘
                  åº§ä½é¢„çº¦ï¼šé€šè¿‡â€œè¥¿å—äº¤å¤§å›¾ä¹¦é¦†â€APPé¢„çº¦ï¼Œå•æ¬¡æœ€é•¿4å°æ—¶ï¼Œè¶…æ—¶æœªåˆ°è‡ªåŠ¨é‡Šæ”¾
                </li>
                <li>
                  ğŸ“±
                  å åº§ç¦æ­¢ï¼šç¦æ­¢ç”¨ä¹¦åŒ…ã€ä¹¦ç±ç­‰ç‰©å“å åº§ï¼Œç¦»å¼€è¶…30åˆ†é’Ÿè§†ä¸ºæ”¾å¼ƒåº§ä½
                </li>
                <li>
                  ğŸ”‡ å®‰é™è¦æ±‚ï¼šä¿æŒä½å£°äº¤æµï¼Œç”µå­è®¾å¤‡éŸ³é‡â‰¤30%ï¼Œç¦æ­¢å¤–æ”¾è§†é¢‘/éŸ³ä¹
                </li>
                <li>
                  ğŸš«
                  é¥®é£Ÿé™åˆ¶ï¼šä»…å…è®¸æºå¸¦å¯†å°æ°´æ¯ï¼Œç¦æ­¢é£Ÿç”¨é›¶é£Ÿã€å¤–å–ï¼ˆå’–å•¡å…åŒºåŸŸé™¤å¤–ï¼‰
                </li>
                <li>
                  â°
                  é—­é¦†æé†’ï¼šé—­é¦†å‰30åˆ†é’Ÿåœæ­¢è¿›å…¥ï¼Œå‰10åˆ†é’Ÿæ¸…åœºï¼Œéœ€åŠæ—¶æ•´ç†ä¸ªäººç‰©å“
                </li>
              </ul>
            </div>

            <div class="info-section">
              <h3>è®¾æ–½æœåŠ¡</h3>
              <ul class="facilities-list">
                <li>
                  ğŸ“– è‡ªä¹ å®¤ï¼š1-3æ¥¼ï¼ˆ1000+åº§ä½ï¼Œæ”¯æŒçº¿ä¸Šé¢„çº¦ï¼Œé…å¤‡ç©ºè°ƒå’ŒæŠ¤çœ¼ç¯ï¼‰
                </li>
                <li>
                  ğŸ’» ç”µå­é˜…è§ˆå®¤ï¼š2æ¥¼ï¼ˆ200+å°ç”µè„‘ï¼Œå…è´¹ä½¿ç”¨ï¼Œéœ€åˆ·æ ¡å›­å¡ç™»å½•ï¼‰
                </li>
                <li>
                  â˜•
                  å­¦æœ¯å’–å•¡å…ï¼š1æ¥¼ï¼ˆæä¾›ç®€é¤ã€å’–å•¡ï¼Œæ”¯æŒæ— çº¿å……ç”µï¼Œæ¶ˆè´¹åŒºéœ€ä¿æŒå®‰é™ï¼‰
                </li>
                <li>
                  ğŸ”Œ
                  å……ç”µåŒºï¼šå„æ¥¼å±‚èµ°å»Šï¼ˆæ”¯æŒType-C/USB-Aå¿«å……ï¼Œéƒ¨åˆ†åº§ä½é…å¤‡æ’åº§ï¼‰
                </li>
                <li>
                  ğŸ“š é¦†è—èµ„æºï¼š150ä¸‡+å†Œçº¸è´¨ä¹¦ï¼Œ500ä¸‡+å†Œç”µå­ä¹¦ï¼Œ2000+ç§ä¸­å¤–æ–‡æœŸåˆŠ
                </li>
                <li>
                  ğŸ¥
                  å­¦æœ¯æŠ¥å‘Šå…ï¼š4æ¥¼ï¼ˆå¯é¢„çº¦ä¸¾åŠè®²åº§ã€ç ”è®¨ä¼šï¼Œå®¹é‡200äººï¼Œéœ€æå‰3å¤©ç”³è¯·ï¼‰
                </li>
              </ul>
            </div>

            <div class="info-section">
              <h3>äº¤é€šæŒ‡å¼•</h3>
              <p>
                æ ¡å†…è·¯çº¿ï¼šä»æ ¡å¤§é—¨æ­¥è¡Œçº¦15åˆ†é’Ÿï¼›ä¹˜åæ ¡å†…æ‘†æ¸¡è½¦ï¼ˆ1å·çº¿ï¼‰è‡³ã€Œå›¾ä¹¦é¦†ç«™ã€ä¸‹è½¦å³è¾¾ï¼›å„æ•™å­¦æ¥¼è‡³å›¾ä¹¦é¦†å‡æœ‰æŒ‡ç¤ºç‰Œï¼›<br />
                æ ¡å¤–è·¯çº¿ï¼šåœ°é“2å·çº¿ã€Œäº¤å¤§ç«™ã€Då£å‡ºï¼Œæ­¥è¡Œ10åˆ†é’Ÿè‡³æ ¡å›­ä¸œé—¨ï¼Œè¿›å…¥åç›´è¡Œ800ç±³ï¼›è‡ªé©¾å¯åœè‡³å›¾ä¹¦é¦†åœ°ä¸‹åœè½¦åœºï¼ˆå‡­æ ¡å›­å¡å…è´¹2å°æ—¶ï¼‰ã€‚
              </p>
            </div>
          </div>
        </div>

        <!-- 2. å¤§å±å¤§æ•°æ®å¯è§†åŒ–æ¨¡å—ï¼ˆåŸºäºEChartsï¼‰ -->
        <div v-if="activeTab === 'data'" class="data-visual-section">
          <!-- æ•°æ®æ¦‚è§ˆå¡ç‰‡ï¼ˆé¡¶éƒ¨å…³é”®æŒ‡æ ‡ï¼‰ -->
          <div class="data-cards">
            <div class="data-card">
              <div class="data-title">ä»Šæ—¥åˆ°é¦†äººæ•°</div>
              <div class="data-value">{{ todayVisitors }}</div>
              <div class="data-trend up">â†‘12% è¾ƒæ˜¨æ—¥</div>
            </div>
            <div class="data-card">
              <div class="data-title">å½“å‰åœ¨é¦†äººæ•°</div>
              <div class="data-value">{{ currentVisitors }}</div>
              <div class="data-trend down">â†“5% è¾ƒä¸Šå°æ—¶</div>
            </div>
            <div class="data-card">
              <div class="data-title">ä»Šæ—¥å€Ÿé˜…é‡</div>
              <div class="data-value">{{ todayBorrows }}</div>
              <div class="data-trend up">â†‘8% è¾ƒæ˜¨æ—¥</div>
            </div>
            <div class="data-card">
              <div class="data-title">åº§ä½ä½¿ç”¨ç‡</div>
              <div class="data-value">{{ seatUsage }}%</div>
              <div class="data-trend up">â†‘15% è¾ƒä¸Šå‘¨</div>
            </div>
          </div>

          <!-- å›¾è¡¨åˆ‡æ¢æŒ‰é’® -->
          <div class="chart-tabs">
            <button
              class="chart-tab-btn"
              :class="{ active: currentChart === 'line' }"
              @click="switchChart('line')"
            >
              ğŸ“ˆ åº§ä½ä½¿ç”¨ç‡
            </button>
            <button
              class="chart-tab-btn"
              :class="{ active: currentChart === 'pie' }"
              @click="switchChart('pie')"
            >
              ğŸ“Š å›¾ä¹¦åˆ†ç±»
            </button>
            <button
              class="chart-tab-btn"
              :class="{ active: currentChart === 'bar' }"
              @click="switchChart('bar')"
            >
              â° å€Ÿé˜…æ—¶æ®µ
            </button>
            <button
              class="chart-tab-btn"
              :class="{ active: currentChart === 'wordCloud' }"
              @click="switchChart('wordCloud')"
            >
              â˜ï¸ çƒ­é—¨å…³é”®è¯
            </button>
          </div>

          <!-- æ ¸å¿ƒå›¾è¡¨åŒºåŸŸ(ä½¿ç”¨ECharts) -->
          <div class="charts-container">
            <!-- å›¾è¡¨1:è¿‘7å¤©åº§ä½ä½¿ç”¨ç‡è¶‹åŠ¿(æŠ˜çº¿å›¾) -->
            <div v-show="currentChart === 'line'" class="chart-item">
              <h4>ğŸ“ˆ è¿‘7å¤©åº§ä½ä½¿ç”¨ç‡è¶‹åŠ¿</h4>
              <div ref="lineChart" class="chart-canvas"></div>
            </div>

            <!-- å›¾è¡¨2:å›¾ä¹¦åˆ†ç±»å€Ÿé˜…å æ¯”(é¥¼å›¾) -->
            <div v-show="currentChart === 'pie'" class="chart-item">
              <h4>ğŸ“Š å›¾ä¹¦åˆ†ç±»å€Ÿé˜…å æ¯”</h4>
              <div ref="pieChart" class="chart-canvas"></div>
            </div>

            <!-- å›¾è¡¨3:æ¯æ—¥å€Ÿé˜…é«˜å³°æ—¶æ®µ(æŸ±çŠ¶å›¾) -->
            <div v-show="currentChart === 'bar'" class="chart-item">
              <h4>â° æ¯æ—¥å€Ÿé˜…é«˜å³°æ—¶æ®µ</h4>
              <div ref="barChart" class="chart-canvas"></div>
            </div>

            <!-- å›¾è¡¨4:çƒ­é—¨æœç´¢è¯äº‘ -->
            <div v-show="currentChart === 'wordCloud'" class="chart-item">
              <h4>â˜ï¸ çƒ­é—¨æœç´¢å…³é”®è¯</h4>
              <div ref="wordCloudChart" class="chart-canvas"></div>
            </div>
          </div>
        </div>

        <!-- 3. è‡ªä¹ å®¤é¢„çº¦æ¨¡å— -->
        <div v-if="activeTab === 'booking'" class="booking-section">
          <!-- é¢„è®¢è¡¨å• -->
          <div class="booking-card">
            <h3>é¢„çº¦ä¿¡æ¯</h3>
            <div class="booking-form">
              <div class="form-row">
                <label>æ—¥æœŸ</label>
                <input type="date" v-model="form.date" />
              </div>
              <div class="form-row two">
                <div>
                  <label>å¼€å§‹æ—¶é—´</label>
                  <input type="time" v-model="form.start" />
                </div>
                <div>
                  <label>æ—¶é•¿</label>
                  <select v-model.number="form.duration">
                    <option :value="1">1å°æ—¶</option>
                    <option :value="2">2å°æ—¶</option>
                    <option :value="3">3å°æ—¶</option>
                    <option :value="4">4å°æ—¶ï¼ˆä¸Šé™ï¼‰</option>
                  </select>
                </div>
              </div>
              <div class="form-row two">
                <div>
                  <label>äººæ•°</label>
                  <input
                    type="number"
                    min="1"
                    max="10"
                    v-model.number="form.attendees"
                  />
                </div>
                <div>
                  <label>å…³é”®å­—ï¼ˆå¯é€‰ï¼‰</label>
                  <input
                    type="text"
                    placeholder="æŒ‰æˆ¿é—´åç§°ç­›é€‰ï¼Œå¦‚ A101"
                    v-model="roomKeyword"
                  />
                </div>
              </div>
              <div class="hint">
                å¯é¢„çº¦æ—¶é—´æ®µï¼šæ¯æ—¥ 08:00 - 22:00ï¼›å•æ¬¡æœ€é•¿ 4
                å°æ—¶ï¼›è¯·ç¡®ä¿äººæ•°ä¸è¶…è¿‡æˆ¿é—´å®¹é‡ã€‚
              </div>
            </div>
          </div>

          <!-- æˆ¿é—´é€‰æ‹© -->
          <div class="booking-card">
            <h3>é€‰æ‹©è‡ªä¹ å®¤</h3>
            <div class="room-grid">
              <div
                v-for="room in filteredRooms"
                :key="room.id"
                class="room-item"
                :class="{
                  selected: form.roomId === room.id,
                  unavailable: !isRoomAvailable(
                    room,
                    form.date,
                    form.start,
                    form.duration
                  ),
                }"
                @click="selectRoom(room)"
                :title="roomTooltip(room)"
              >
                <div class="room-name">{{ room.name }}</div>
                <div class="room-meta">å®¹çº³ {{ room.capacity }} äºº</div>
                <div
                  class="room-status"
                  :class="{
                    ok: isRoomAvailable(
                      room,
                      form.date,
                      form.start,
                      form.duration
                    ),
                  }"
                >
                  {{
                    isRoomAvailable(room, form.date, form.start, form.duration)
                      ? "å¯é¢„çº¦"
                      : "æ—¶é—´å†²çª"
                  }}
                </div>
              </div>
            </div>
          </div>

          <!-- æäº¤é¢„çº¦ -->
          <div class="booking-actions">
            <button
              class="btn btn-primary"
              :disabled="!canSubmit"
              @click="submitBooking"
            >
              âœ… æäº¤é¢„çº¦
            </button>
            <div class="error-text" v-if="errorText">{{ errorText }}</div>
          </div>

          <!-- é¢„çº¦è®°å½• -->
          <div class="booking-card">
            <h3>æˆ‘çš„é¢„çº¦</h3>
            <div v-if="upcomingReservations.length === 0" class="empty">
              æš‚æ— é¢„çº¦è®°å½•
            </div>
            <div v-else class="reservation-list">
              <div
                class="reservation-item"
                v-for="r in upcomingReservations"
                :key="r.id"
              >
                <div class="reservation-main">
                  <div class="reservation-title">
                    {{ r.roomName }} Â· {{ r.attendees }} äºº
                  </div>
                  <div class="reservation-time">
                    {{ r.date }} {{ r.start }} - {{ r.end }}
                  </div>
                </div>
                <button
                  class="btn btn-secondary btn-cancel"
                  @click="cancelReservation(r.id)"
                >
                  å–æ¶ˆ
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" @click="closeModal">å…³é—­</button>
        <button class="btn btn-primary" @click="navigateToLibrary">
          ğŸ—ºï¸ å¯¼èˆªåˆ°æ­¤
        </button>
        <button
          class="btn btn-info"
          @click="openFullScreenData"
          v-if="activeTab === 'data'"
        >
          ğŸ“Š æŸ¥çœ‹å®Œæ•´å¤§å±
        </button>
      </div>
    </div>
  </div>
</template>

<script setup>
import {
  ref,
  onMounted,
  watch,
  nextTick,
  getCurrentInstance,
  computed,
} from "vue";

// 1. æ¥æ”¶çˆ¶ç»„ä»¶å‚æ•°
const props = defineProps({
  show: {
    type: Boolean,
    default: false,
    required: true,
  },
});

// 2. å®šä¹‰è§¦å‘äº‹ä»¶
const emit = defineEmits(["close", "navigate", "open-full-screen-data"]);

// 3. å†…éƒ¨çŠ¶æ€ç®¡ç†
const activeTab = ref("rules");
const currentChart = ref("line"); // å½“å‰æ˜¾ç¤ºçš„å›¾è¡¨

// æ¨¡æ‹Ÿå›¾ä¹¦é¦†æ ¸å¿ƒæ•°æ®
const todayVisitors = ref(1286);
const currentVisitors = ref(842);
const todayBorrows = ref(356);
const seatUsage = ref(78);

// 4. ECharts å®ä¾‹å¼•ç”¨
const lineChart = ref(null);
const pieChart = ref(null);
const barChart = ref(null);
const wordCloudChart = ref(null);
let lineChartInstance = null;
let pieChartInstance = null;
let barChartInstance = null;
let wordCloudChartInstance = null;

// 5. ECharts é…ç½®
// æŠ˜çº¿å›¾é…ç½® - åº§ä½ä½¿ç”¨ç‡è¶‹åŠ¿
const lineChartOption = ref({
  backgroundColor: "transparent",
  grid: {
    top: "15%",
    left: "10%",
    right: "10%",
    bottom: "15%",
  },
  xAxis: {
    type: "category",
    data: ["å‘¨ä¸€", "å‘¨äºŒ", "å‘¨ä¸‰", "å‘¨å››", "å‘¨äº”", "å‘¨å…­", "å‘¨æ—¥"],
    axisLine: {
      lineStyle: { color: "#00d4ff" },
    },
    axisLabel: {
      color: "#00d4ff",
    },
  },
  yAxis: {
    type: "value",
    max: 100,
    axisLine: {
      lineStyle: { color: "#00d4ff" },
    },
    axisLabel: {
      color: "#00d4ff",
      formatter: "{value}%",
    },
    splitLine: {
      lineStyle: { color: "rgba(0, 212, 255, 0.2)" },
    },
  },
  series: [
    {
      data: [65, 72, 88, 76, 92, 45, 38],
      type: "line",
      smooth: true,
      symbol: "circle",
      symbolSize: 8,
      lineStyle: {
        width: 3,
        color: {
          type: "linear",
          x: 0,
          y: 0,
          x2: 1,
          y2: 0,
          colorStops: [
            {
              offset: 0,
              color: "#2575fc",
            },
            {
              offset: 1,
              color: "#00d4ff",
            },
          ],
        },
      },
      itemStyle: {
        color: "#00d4ff",
        shadowColor: "#00d4ff",
        shadowBlur: 10,
      },
      areaStyle: {
        color: {
          type: "linear",
          x: 0,
          y: 0,
          x2: 0,
          y2: 1,
          colorStops: [
            {
              offset: 0,
              color: "rgba(37, 117, 252, 0.3)",
            },
            {
              offset: 1,
              color: "rgba(0, 212, 255, 0.1)",
            },
          ],
        },
      },
    },
  ],
});

// é¥¼å›¾é…ç½® - å›¾ä¹¦åˆ†ç±»å æ¯”
const pieChartOption = ref({
  backgroundColor: "transparent",
  legend: {
    orient: "vertical",
    left: "10%",
    top: "20%",
    textStyle: {
      color: "#00d4ff",
    },
  },
  series: [
    {
      type: "pie",
      radius: ["40%", "70%"],
      center: ["60%", "50%"],
      data: [
        { name: "å·¥ç§‘ç±»", value: 42 },
        { name: "æ–‡å­¦ç±»", value: 23 },
        { name: "ç†å­¦ç±»", value: 15 },
        { name: "ç¤¾ç§‘ç±»", value: 12 },
        { name: "å…¶ä»–ç±»", value: 8 },
      ],
      emphasis: {
        itemStyle: {
          shadowBlur: 10,
          shadowOffsetX: 0,
          shadowColor: "rgba(0, 0, 0, 0.5)",
        },
      },
      itemStyle: {
        borderRadius: 8,
        borderColor: "#fff",
        borderWidth: 2,
      },
      label: {
        color: "#00d4ff",
        formatter: "{b}: {c}%",
      },
      color: ["#2575fc", "#6a11cb", "#00b42a", "#f53f3f", "#ff7d00"],
    },
  ],
});

// æŸ±çŠ¶å›¾é…ç½® - å€Ÿé˜…é«˜å³°æ—¶æ®µ
const barChartOption = ref({
  backgroundColor: "transparent",
  grid: {
    top: "15%",
    left: "15%",
    right: "10%",
    bottom: "20%",
  },
  xAxis: {
    type: "category",
    data: [
      "8-10ç‚¹",
      "10-12ç‚¹",
      "12-14ç‚¹",
      "14-16ç‚¹",
      "16-18ç‚¹",
      "18-20ç‚¹",
      "20-22ç‚¹",
    ],
    axisLine: {
      lineStyle: { color: "#00d4ff" },
    },
    axisLabel: {
      color: "#00d4ff",
      rotate: 45,
    },
  },
  yAxis: {
    type: "value",
    axisLine: {
      lineStyle: { color: "#00d4ff" },
    },
    axisLabel: {
      color: "#00d4ff",
    },
    splitLine: {
      lineStyle: { color: "rgba(0, 212, 255, 0.2)" },
    },
  },
  series: [
    {
      data: [45, 82, 38, 95, 120, 78, 62],
      type: "bar",
      barWidth: "60%",
      itemStyle: {
        color: {
          type: "linear",
          x: 0,
          y: 0,
          x2: 0,
          y2: 1,
          colorStops: [
            {
              offset: 0,
              color: "#00d4ff",
            },
            {
              offset: 1,
              color: "#2575fc",
            },
          ],
        },
        borderRadius: [4, 4, 0, 0],
        shadowColor: "#2575fc",
        shadowBlur: 10,
        shadowOffsetY: 5,
      },
    },
  ],
});

// è¯äº‘å›¾é…ç½® - çƒ­é—¨æœç´¢å…³é”®è¯
const wordCloudOption = ref({
  backgroundColor: "transparent",
  series: [
    {
      type: "wordCloud",
      shape: "circle",
      left: "center",
      top: "center",
      width: "100%",
      height: "100%",
      right: null,
      bottom: null,
      sizeRange: [14, 60],
      rotationRange: [-45, 45],
      rotationStep: 45,
      gridSize: 8,
      drawOutOfBound: false,
      layoutAnimation: true,
      textStyle: {
        fontFamily: "Microsoft YaHei, sans-serif",
        fontWeight: "bold",
        color: function () {
          const colors = [
            "#2575fc",
            "#00d4ff",
            "#6a11cb",
            "#00b42a",
            "#f53f3f",
            "#ff7d00",
            "#00d4ff",
            "#9254de",
          ];
          return colors[Math.floor(Math.random() * colors.length)];
        },
      },
      emphasis: {
        focus: "self",
        textStyle: {
          textShadowBlur: 10,
          textShadowColor: "#00d4ff",
        },
      },
      data: [
        { name: "æ•°æ®ç»“æ„", value: 1500 },
        { name: "ç®—æ³•å¯¼è®º", value: 1200 },
        { name: "æœºå™¨å­¦ä¹ ", value: 1100 },
        { name: "æ“ä½œç³»ç»Ÿ", value: 1000 },
        { name: "è®¡ç®—æœºç½‘ç»œ", value: 950 },
        { name: "æ·±åº¦å­¦ä¹ ", value: 900 },
        { name: "äººå·¥æ™ºèƒ½", value: 850 },
        { name: "Pythonç¼–ç¨‹", value: 800 },
        { name: "æ•°æ®åº“åŸç†", value: 750 },
        { name: "è½¯ä»¶å·¥ç¨‹", value: 700 },
        { name: "Javaç¼–ç¨‹", value: 650 },
        { name: "ç¼–è¯‘åŸç†", value: 600 },
        { name: "é«˜ç­‰æ•°å­¦", value: 550 },
        { name: "çº¿æ€§ä»£æ•°", value: 500 },
        { name: "æ¦‚ç‡è®º", value: 480 },
        { name: "ç¦»æ•£æ•°å­¦", value: 450 },
        { name: "è®¡ç®—æœºç»„æˆ", value: 420 },
        { name: "Webå¼€å‘", value: 400 },
        { name: "å¤§æ•°æ®", value: 380 },
        { name: "äº‘è®¡ç®—", value: 350 },
        { name: "åŒºå—é“¾", value: 320 },
        { name: "ç‰©è”ç½‘", value: 300 },
        { name: "ä¿¡æ¯å®‰å…¨", value: 280 },
        { name: "C++ç¨‹åºè®¾è®¡", value: 260 },
        { name: "æ•°å­—å›¾åƒå¤„ç†", value: 240 },
      ],
    },
  ],
});

// 6. åˆå§‹åŒ–å›¾è¡¨å‡½æ•°
const { proxy } = getCurrentInstance();

const initCharts = () => {
  if (
    !lineChart.value ||
    !pieChart.value ||
    !barChart.value ||
    !wordCloudChart.value
  )
    return;

  // åˆå§‹åŒ–æŠ˜çº¿å›¾
  lineChartInstance = proxy.$echarts.init(lineChart.value);
  lineChartInstance.setOption(lineChartOption.value);

  // åˆå§‹åŒ–é¥¼å›¾
  pieChartInstance = proxy.$echarts.init(pieChart.value);
  pieChartInstance.setOption(pieChartOption.value);

  // åˆå§‹åŒ–æŸ±çŠ¶å›¾
  barChartInstance = proxy.$echarts.init(barChart.value);
  barChartInstance.setOption(barChartOption.value);

  // åˆå§‹åŒ–è¯äº‘å›¾
  wordCloudChartInstance = proxy.$echarts.init(wordCloudChart.value);
  wordCloudChartInstance.setOption(wordCloudOption.value);
};

// 7. Tabåˆ‡æ¢å¤„ç†å‡½æ•°
const handleTabSwitch = (tab) => {
  activeTab.value = tab;
  if (tab === "data") {
    currentChart.value = "line"; // åˆ‡åˆ°æ•°æ®tabæ—¶é»˜è®¤æ˜¾ç¤ºæŠ˜çº¿å›¾
    nextTick(() => {
      initCharts();
    });
  }
};

// å›¾è¡¨åˆ‡æ¢å‡½æ•°
const switchChart = (chartType) => {
  currentChart.value = chartType;
  // åˆ‡æ¢åé‡æ–°è°ƒæ•´å›¾è¡¨å¤§å°
  nextTick(() => {
    if (chartType === "line" && lineChartInstance) {
      lineChartInstance.resize();
    } else if (chartType === "pie" && pieChartInstance) {
      pieChartInstance.resize();
    } else if (chartType === "bar" && barChartInstance) {
      barChartInstance.resize();
    } else if (chartType === "wordCloud" && wordCloudChartInstance) {
      wordCloudChartInstance.resize();
    }
  });
};

// 8. ç›‘å¬å¼¹çª—æ˜¾ç¤ºçŠ¶æ€
watch(
  () => props.show,
  (newVal) => {
    if (newVal && activeTab.value === "data") {
      nextTick(() => {
        initCharts();
      });
    }
  }
);

// 9. äº‹ä»¶å¤„ç†å‡½æ•°
const closeModal = () => {
  emit("close");
};

const navigateToLibrary = () => {
  emit("navigate");
};

const openFullScreenData = () => {
  // åˆ›å»ºå…¨å±æ•°æ®å¯è§†åŒ–é¡µé¢
  const fullScreenWindow = window.open("", "_blank", "width=1920,height=1080");
  const fullScreenContent = `
    <!DOCTYPE html>
    <html lang="zh-CN">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>è¥¿å—äº¤é€šå¤§å­¦å›¾ä¹¦é¦† - æ•°æ®å¯è§†åŒ–å¤§å±</title>
        <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"><\/script>
        <script src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2.1.0/dist/echarts-wordcloud.min.js"><\/script>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
    font-family: 'Microsoft YaHei', sans-serif;
    overflow: hidden;
    height: 100vh;
}

.fullscreen-container {
    width: 100vw;
    height: 100vh;
    padding: 15px;
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.header {
    text-align: center;
    color: #00d4ff;
    font-size: 28px;
    font-weight: bold;
    text-shadow: 0 0 20px rgba(0, 212, 255, 0.8);
    flex-shrink: 0;
}

.data-overview {
    display: flex;
    gap: 15px;
    height: 100px;
    flex-shrink: 0;
}

.data-card {
    flex: 1;
    background: linear-gradient(135deg, rgba(37, 117, 252, 0.2), rgba(106, 17, 203, 0.2));
    border: 2px solid rgba(37, 117, 252, 0.5);
    border-radius: 12px;
    padding: 12px;
    text-align: center;
    backdrop-filter: blur(10px);
    box-shadow: 0 8px 32px rgba(37, 117, 252, 0.3);
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.data-title {
    color: #00d4ff;
    font-size: 14px;
    margin-bottom: 5px;
    text-shadow: 0 0 10px rgba(0, 212, 255, 0.6);
}

.data-value {
    color: #ffffff;
    font-size: 32px;
    font-weight: bold;
    text-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
}

.charts-area {
    flex: 1;
    min-height: 0;
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    grid-template-rows: repeat(2, 1fr);
    gap: 15px;
}

.chart-container {
    background: linear-gradient(135deg, rgba(26, 26, 46, 0.8), rgba(22, 33, 62, 0.8));
    border: 2px solid rgba(37, 117, 252, 0.4);
    border-radius: 12px;
    padding: 12px;
    backdrop-filter: blur(10px);
    display: flex;
    flex-direction: column;
    min-height: 0;
    overflow: hidden;
}

.chart-title {
    color: #00d4ff;
    font-size: 16px;
    text-align: center;
    margin-bottom: 8px;
    text-shadow: 0 0 10px rgba(0, 212, 255, 0.6);
    flex-shrink: 0;
}

.chart-canvas {
    flex: 1;
    min-height: 0;
    width: 100%;
    height: 100%;
}
</style>
</head>

<body>
    <div class="fullscreen-container">
        <div class="header">
            ğŸ“š è¥¿å—äº¤é€šå¤§å­¦å›¾ä¹¦é¦† - æ•°æ®å¯è§†åŒ–å¤§å±
        </div>
        <div class="data-overview">
            <div class="data-card">
                <div class="data-title">ä»Šæ—¥åˆ°é¦†äººæ•°</div>
                <div class="data-value">${todayVisitors.value}</div>
            </div>
            <div class="data-card">
                <div class="data-title">å½“å‰åœ¨é¦†äººæ•°</div>
                <div class="data-value">${currentVisitors.value}</div>
            </div>
            <div class="data-card">
                <div class="data-title">ä»Šæ—¥å€Ÿé˜…é‡</div>
                <div class="data-value">${todayBorrows.value}</div>
            </div>
            <div class="data-card">
                <div class="data-title">åº§ä½ä½¿ç”¨ç‡</div>
                <div class="data-value">${seatUsage.value}%</div>
            </div>
        </div>
        <div class="charts-area">
            <div class="chart-container">
                <div class="chart-title">ğŸ“ˆ è¿‘7å¤©åº§ä½ä½¿ç”¨ç‡è¶‹åŠ¿</div>
                <div id="lineChart" class="chart-canvas"></div>
            </div>
            <div class="chart-container">
                <div class="chart-title">ğŸ“Š å›¾ä¹¦åˆ†ç±»å€Ÿé˜…å æ¯”</div>
                <div id="pieChart" class="chart-canvas"></div>
            </div>
            <div class="chart-container">
                <div class="chart-title">â° æ¯æ—¥å€Ÿé˜…é«˜å³°æ—¶æ®µ</div>
                <div id="barChart" class="chart-canvas"></div>
            </div>
            <div class="chart-container">
                <div class="chart-title">â˜ï¸ çƒ­é—¨æœç´¢å…³é”®è¯</div>
                <div id="wordCloudChart" class="chart-canvas"></div>
            </div>
        </div>
    </div>
    <script>
            // åˆå§‹åŒ–å›¾è¡¨
            window.onload = function() {
                // æŠ˜çº¿å›¾
                const lineChart = echarts.init(document.getElementById('lineChart'));
                lineChart.setOption(${JSON.stringify(lineChartOption.value)});
                
                // é¥¼å›¾
                const pieChart = echarts.init(document.getElementById('pieChart'));
                pieChart.setOption(${JSON.stringify(pieChartOption.value)});
                
                // æŸ±çŠ¶å›¾
                const barChart = echarts.init(document.getElementById('barChart'));
                barChart.setOption(${JSON.stringify(barChartOption.value)});
                
                // è¯äº‘å›¾
                const wordCloudChart = echarts.init(document.getElementById('wordCloudChart'));
                wordCloudChart.setOption(${JSON.stringify(
                  wordCloudOption.value
                )});
                
                // è‡ªé€‚åº”çª—å£å¤§å°
                window.addEventListener('resize', function() {
                    lineChart.resize();
                    pieChart.resize();
                    barChart.resize();
                    wordCloudChart.resize();
                });
            };
        <\/script>
</body>

</html>
`;
  fullScreenWindow.document.write(fullScreenContent);
  fullScreenWindow.document.close();
};

// ========== è‡ªä¹ å®¤é¢„çº¦ï¼šçŠ¶æ€ä¸é€»è¾‘ ==========
const LS_KEY = "swjtu_library_studyroom_reservations";

// æˆ¿é—´é…ç½®ï¼ˆç¤ºä¾‹ï¼Œå¯æ‰©å±•ï¼‰
const rooms = ref([
  { id: "A101", name: "A101", capacity: 4 },
  { id: "A102", name: "A102", capacity: 6 },
  { id: "A103", name: "A103", capacity: 2 },
  { id: "A201", name: "A201", capacity: 6 },
  { id: "A202", name: "A202", capacity: 8 },
  { id: "A203", name: "A203", capacity: 10 },
  { id: "B101", name: "B101", capacity: 4 },
  { id: "B102", name: "B102", capacity: 6 },
  { id: "B201", name: "B201", capacity: 8 },
]);

// é¢„çº¦è¡¨å•
const todayStr = () => {
  const d = new Date();
  const mm = String(d.getMonth() + 1).padStart(2, "0");
  const dd = String(d.getDate()).padStart(2, "0");
  return `${d.getFullYear()}-${mm}-${dd}`;
};

const form = ref({
  date: todayStr(),
  start: "14:00",
  duration: 2,
  attendees: 2,
  roomId: "",
});

const roomKeyword = ref("");
const errorText = ref("");

const filteredRooms = computed(() => {
  const kw = roomKeyword.value.trim().toLowerCase();
  return rooms.value
    .filter((r) => r.capacity >= (form.value.attendees || 1))
    .filter((r) => !kw || r.name.toLowerCase().includes(kw));
});

function roomTooltip(room) {
  return `å®¹é‡ï¼š${room.capacity} äºº`;
}

function selectRoom(room) {
  if (
    !isRoomAvailable(
      room,
      form.value.date,
      form.value.start,
      form.value.duration
    )
  )
    return;
  form.value.roomId = room.id;
}

function parseTimeToMinutes(t) {
  // t: 'HH:MM'
  const [h, m] = (t || "00:00").split(":").map(Number);
  return h * 60 + m;
}

function minutesToTime(mins) {
  const h = Math.floor(mins / 60);
  const m = mins % 60;
  return `${String(h).padStart(2, "0")}:${String(m).padStart(2, "0")}`;
}

function calcEnd(start, durationHours) {
  const endMin = parseTimeToMinutes(start) + durationHours * 60;
  return minutesToTime(endMin);
}

const endTime = computed(() => calcEnd(form.value.start, form.value.duration));

// æœ¬åœ°é¢„çº¦æ•°æ®
const reservations = ref([]);

function loadReservations() {
  try {
    const raw = localStorage.getItem(LS_KEY);
    reservations.value = raw ? JSON.parse(raw) : [];
  } catch (e) {
    reservations.value = [];
  }
}

function saveReservations() {
  try {
    localStorage.setItem(LS_KEY, JSON.stringify(reservations.value));
  } catch (e) {
    /* ignore */
  }
}

onMounted(() => {
  loadReservations();
});

// å¯é¢„çº¦æ—¶é—´èŒƒå›´
const OPEN_TIME_MIN = 8 * 60; // 08:00
const CLOSE_TIME_MIN = 22 * 60; // 22:00

function isValidTimeRange(dateStr, start, duration) {
  const s = parseTimeToMinutes(start);
  const e = s + duration * 60;
  if (s < OPEN_TIME_MIN || e > CLOSE_TIME_MIN) return false;
  // å¦‚æœæ˜¯ä»Šå¤©ï¼Œå¼€å§‹æ—¶é—´ä¸èƒ½æ—©äºå½“å‰æ—¶é—´çš„å5åˆ†é’Ÿ
  try {
    const today = todayStr();
    if (dateStr === today) {
      const now = new Date();
      const nowMin = now.getHours() * 60 + now.getMinutes();
      if (s < nowMin + 5) return false;
    }
  } catch (e) {}
  return true;
}

function overlap(aStart, aEnd, bStart, bEnd) {
  return aStart < bEnd && bStart < aEnd;
}

function isRoomAvailable(room, dateStr, start, duration) {
  const s = parseTimeToMinutes(start);
  const e = s + duration * 60;
  // æ—¶é—´åˆæ³•æ€§
  if (!isValidTimeRange(dateStr, start, duration)) return false;
  // ä¸å·²æœ‰é¢„çº¦å†²çªåˆ¤æ–­
  return !reservations.value.some(
    (r) =>
      r.roomId === room.id &&
      r.date === dateStr &&
      overlap(s, e, parseTimeToMinutes(r.start), parseTimeToMinutes(r.end))
  );
}

const canSubmit = computed(() => {
  errorText.value = "";
  const r = rooms.value.find((x) => x.id === form.value.roomId);
  if (!r) {
    errorText.value = "è¯·é€‰æ‹©ä¸€ä¸ªå¯é¢„çº¦çš„è‡ªä¹ å®¤";
    return false;
  }
  if (form.value.attendees < 1) {
    errorText.value = "äººæ•°éœ€è‡³å°‘ä¸º 1";
    return false;
  }
  if (form.value.attendees > r.capacity) {
    errorText.value = "äººæ•°è¶…è¿‡æˆ¿é—´å®¹é‡";
    return false;
  }
  if (
    !isValidTimeRange(form.value.date, form.value.start, form.value.duration)
  ) {
    errorText.value = "æ—¶é—´ä¸åˆæ³•æˆ–ä¸åœ¨å¼€æ”¾æ—¶æ®µ";
    return false;
  }
  if (
    !isRoomAvailable(r, form.value.date, form.value.start, form.value.duration)
  ) {
    errorText.value = "æ‰€é€‰æ—¶é—´ä¸å·²æœ‰é¢„çº¦å†²çª";
    return false;
  }
  return true;
});

function submitBooking() {
  if (!canSubmit.value) return;
  const r = rooms.value.find((x) => x.id === form.value.roomId);
  const data = {
    id: `${Date.now()}_${Math.random().toString(16).slice(2, 8)}`,
    roomId: r.id,
    roomName: r.name,
    capacity: r.capacity,
    attendees: form.value.attendees,
    date: form.value.date,
    start: form.value.start,
    end: endTime.value,
  };
  reservations.value.push(data);
  saveReservations();
  alert("é¢„çº¦æˆåŠŸï¼");
}

const upcomingReservations = computed(() => {
  // åªæ˜¾ç¤ºä»Šå¤©åŠä»¥åçš„é¢„çº¦ï¼ŒæŒ‰æ—¶é—´æ’åº
  const now = new Date();
  const today = todayStr();
  return [...reservations.value]
    .filter(
      (r) =>
        r.date > today ||
        (r.date === today &&
          parseTimeToMinutes(r.end) >= now.getHours() * 60 + now.getMinutes())
    )
    .sort((a, b) => (a.date + a.start).localeCompare(b.date + b.start));
});

function cancelReservation(id) {
  reservations.value = reservations.value.filter((r) => r.id !== id);
  saveReservations();
}
</script>

<style scoped>
/* åŸæœ‰æ ·å¼ä¿ç•™ï¼Œæ–°å¢Tabåˆ‡æ¢ã€æ•°æ®å¯è§†åŒ–ç›¸å…³æ ·å¼ */
.library-modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.4);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 11000;
  backdrop-filter: blur(2px);
}

.library-modal {
  background: white;
  border-radius: 16px;
  width: 90%;
  max-width: 900px;
  /* åŠ å®½å¼¹çª—ä»¥é€‚é…æ•°æ®å¯è§†åŒ– */
  max-height: 85vh;
  overflow-y: auto;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  position: relative;
  animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.modal-close {
  position: absolute;
  top: 16px;
  right: 16px;
  background: none;
  border: none;
  font-size: 24px;
  cursor: pointer;
  color: #999;
  padding: 0;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10;
  transition: color 0.18s;
}

.modal-close:hover {
  color: #333;
}

.modal-header {
  padding: 24px 24px 16px;
  border-bottom: 2px solid #f0f0f0;
}

.modal-header h2 {
  margin: 0 0 16px 0;
  font-size: 22px;
  font-weight: 700;
  color: #333;
}

/* æ–°å¢ï¼šTabåˆ‡æ¢æ ·å¼ */
.tab-container {
  display: flex;
  border-radius: 8px;
  overflow: hidden;
  background: #f5f5f5;
  margin-top: 8px;
}

.tab-item {
  flex: 1;
  text-align: center;
  padding: 10px 0;
  font-size: 14px;
  font-weight: 600;
  color: #666;
  cursor: pointer;
  transition: all 0.2s;
}

.tab-item.active {
  background: #2575fc;
  color: white;
}

.tab-item:hover:not(.active) {
  background: #e9e9e9;
}

.modal-body {
  padding: 24px;
}

.info-section {
  margin-bottom: 20px;
}

.info-section:last-child {
  margin-bottom: 0;
}

.info-section h3 {
  margin: 0 0 12px 0;
  font-size: 14px;
  font-weight: 700;
  color: #2575fc;
  border-bottom: 2px solid #2575fc;
  padding-bottom: 6px;
}

.info-item {
  display: flex;
  align-items: center;
  margin-bottom: 10px;
  font-size: 14px;
  color: #333;
}

.label {
  font-weight: 600;
  margin-right: 8px;
  color: #555;
}

.facilities-list {
  list-style: none;
  margin: 0;
  padding: 0;
}

.facilities-list li {
  padding: 8px 0;
  font-size: 14px;
  color: #555;
  border-bottom: 1px solid #f0f0f0;
}

.facilities-list li:last-child {
  border-bottom: none;
}

.info-section p {
  margin: 0;
  font-size: 13px;
  line-height: 1.6;
  color: #666;
}

.modal-footer {
  display: flex;
  gap: 12px;
  padding: 16px 24px;
  border-top: 1px solid #f0f0f0;
  background: #f9f9f9;
  border-radius: 0 0 16px 16px;
}

.btn {
  flex: 1;
  padding: 12px 16px;
  border: none;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.18s;
}

.btn-secondary {
  background: #e0e0e0;
  color: #333;
}

.btn-secondary:hover {
  background: #d0d0d0;
}

.btn-primary {
  background: linear-gradient(90deg, #2575fc, #0d47a1);
  color: white;
}

.btn-primary:hover {
  box-shadow: 0 4px 12px rgba(37, 117, 252, 0.3);
}

/* æ–°å¢ï¼šä¿¡æ¯æŒ‰é’®ï¼ˆæŸ¥çœ‹å®Œæ•´å¤§å±ï¼‰ */
.btn-info {
  background: linear-gradient(90deg, #6a11cb, #2575fc);
  color: white;
}

.btn-info:hover {
  box-shadow: 0 4px 12px rgba(106, 17, 203, 0.3);
}

/* è¦†ç›–é¢„çº¦åˆ—è¡¨ä¸­çš„â€œå–æ¶ˆâ€æŒ‰é’®ï¼Œè®©å…¶ä¿æŒè‡ªé€‚åº”å®½åº¦ */
.btn-cancel {
  flex: 0 0 auto; /* è¦†ç›– .btn çš„ flex: 1 è®¾ç½® */
  padding: 8px 12px;
  white-space: nowrap;
}

/* æ»šåŠ¨æ¡ç¾åŒ– */
.library-modal::-webkit-scrollbar {
  width: 6px;
}

.library-modal::-webkit-scrollbar-track {
  background: #f0f0f0;
  border-radius: 3px;
}

.library-modal::-webkit-scrollbar-thumb {
  background: #ccc;
  border-radius: 3px;
}

.library-modal::-webkit-scrollbar-thumb:hover {
  background: #999;
}

/* æ–°å¢ï¼šæ•°æ®å¯è§†åŒ–åŒºåŸŸæ ·å¼ */
.data-visual-section {
  display: flex;
  flex-direction: column;
  gap: 20px;
  background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
  border-radius: 12px;
  padding: 20px;
  margin: -24px;
  margin-top: 0;
}

/* æ•°æ®å¡ç‰‡æ ·å¼ */
.data-cards {
  display: flex;
  gap: 16px;
  flex-wrap: wrap;
}

.data-card {
  flex: 1;
  min-width: 160px;
  background: linear-gradient(
    135deg,
    rgba(37, 117, 252, 0.1),
    rgba(106, 17, 203, 0.1)
  );
  border: 1px solid rgba(37, 117, 252, 0.3);
  border-radius: 12px;
  padding: 16px;
  box-shadow: 0 4px 15px rgba(37, 117, 252, 0.2);
  transition: transform 0.2s, box-shadow 0.2s;
  backdrop-filter: blur(10px);
}

.data-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 25px rgba(37, 117, 252, 0.4);
  border-color: rgba(37, 117, 252, 0.6);
}

.data-title {
  font-size: 14px;
  color: #00d4ff;
  margin-bottom: 8px;
  text-shadow: 0 0 5px rgba(0, 212, 255, 0.5);
}

.data-value {
  font-size: 28px;
  font-weight: 700;
  color: #ffffff;
  margin-bottom: 4px;
  text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
}

.data-trend {
  font-size: 12px;
}

.data-trend.up {
  color: #00ff88;
  text-shadow: 0 0 5px rgba(0, 255, 136, 0.5);
}

.data-trend.down {
  color: #ff4757;
  text-shadow: 0 0 5px rgba(255, 71, 87, 0.5);
}

/* å›¾è¡¨åˆ‡æ¢æŒ‰é’® */
.chart-tabs {
  display: flex;
  gap: 12px;
  margin-bottom: 20px;
  flex-wrap: wrap;
}

.chart-tab-btn {
  flex: 1;
  min-width: 120px;
  padding: 12px 16px;
  background: linear-gradient(
    135deg,
    rgba(37, 117, 252, 0.15),
    rgba(106, 17, 203, 0.15)
  );
  border: 1px solid rgba(37, 117, 252, 0.3);
  border-radius: 10px;
  color: #00d4ff;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
  text-shadow: 0 0 5px rgba(0, 212, 255, 0.3);
}

.chart-tab-btn:hover {
  background: linear-gradient(
    135deg,
    rgba(37, 117, 252, 0.25),
    rgba(106, 17, 203, 0.25)
  );
  border-color: rgba(37, 117, 252, 0.6);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(37, 117, 252, 0.3);
}

.chart-tab-btn.active {
  background: linear-gradient(135deg, #2575fc, #6a11cb);
  border-color: #2575fc;
  color: white;
  text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
  box-shadow: 0 6px 20px rgba(37, 117, 252, 0.5);
}

.chart-tab-btn.active:hover {
  transform: translateY(-3px);
}

/* å›¾è¡¨å®¹å™¨æ ·å¼ */
.charts-container {
  display: flex;
  flex-direction: column;
  min-height: 400px;
}

.chart-item {
  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
  border-radius: 12px;
  padding: 0;
  box-shadow: 0 4px 15px rgba(37, 117, 252, 0.2);
  border: 1px solid rgba(37, 117, 252, 0.3);
  overflow: hidden;
  animation: chartFadeIn 0.3s ease-out;
}

@keyframes chartFadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.chart-item h4 {
  margin: 0 0 5px 0;
  font-size: 16px;
  color: #00d4ff;
  font-weight: 600;
  text-align: center;
  padding: 15px;
  background: rgba(0, 212, 255, 0.1);
  border-bottom: 1px solid rgba(0, 212, 255, 0.3);
  text-shadow: 0 0 8px rgba(0, 212, 255, 0.6);
}

.chart-canvas {
  width: 100%;
  height: 400px;
  background: transparent;
  padding: 15px;
}

/* ECharts å›¾è¡¨æ ·å¼ */
.chart-canvas {
  width: 100%;
  height: 280px;
}

/* è‡ªä¹ å®¤é¢„çº¦æ ·å¼ */
.booking-section {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.booking-card {
  background: #fff;
  border: 1px solid #f0f0f0;
  border-radius: 12px;
  padding: 16px;
  box-shadow: 0 6px 18px rgba(0, 0, 0, 0.06);
}

.booking-card h3 {
  margin: 0 0 12px 0;
  font-size: 14px;
  font-weight: 700;
  color: #2575fc;
  border-bottom: 2px solid #2575fc;
  padding-bottom: 6px;
}

.booking-form {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.form-row {
  display: flex;
  gap: 12px;
  flex-wrap: wrap; /* é˜²æ­¢åœ¨çª„å±æ—¶è¢«å³ä¾§è£åˆ‡ */
}

.form-row.two > div {
  flex: 1 1 280px; /* åœ¨ç©ºé—´ä¸è¶³æ—¶è‡ªåŠ¨æ¢è¡Œ */
  min-width: 0; /* å…è®¸å­å…ƒç´ æ”¶ç¼©ï¼Œé¿å…å†…å®¹æŠŠå®¹å™¨æ’‘ç ´ */
}

.form-row label {
  display: block;
  font-size: 12px;
  color: #666;
  margin-bottom: 6px;
}

.form-row input,
.form-row select {
  width: 90%;
  padding: 10px 12px;
  border: 1px solid #e6e6e6;
  border-radius: 8px;
  font-size: 14px;
  outline: none;
  min-width: 0; /* è§£å†³ Safari/Chrome åœ¨ flex ä¸‹çš„æº¢å‡ºé—®é¢˜ */
}

.form-row input:focus,
.form-row select:focus {
  border-color: #2575fc;
  box-shadow: 0 0 0 2px rgba(37, 117, 252, 0.12);
}

.hint {
  font-size: 12px;
  color: #888;
}

.room-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
}

.room-item {
  border: 1px solid #e6e6e6;
  border-radius: 10px;
  padding: 12px;
  cursor: pointer;
  transition: all 0.2s;
  background: #fafafa;
}

.room-item:hover {
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
}
.room-item.selected {
  border-color: #2575fc;
  background: #f3f9ff;
}
.room-item.unavailable {
  opacity: 0.5;
  cursor: not-allowed;
}

.room-name {
  font-weight: 700;
  color: #333;
}
.room-meta {
  font-size: 12px;
  color: #666;
  margin-top: 4px;
}
.room-status {
  margin-top: 6px;
  font-size: 12px;
  color: #ff4757;
}
.room-status.ok {
  color: #00b42a;
}

.booking-actions {
  display: flex;
  align-items: center;
  gap: 12px;
}

.error-text {
  color: #ff4757;
  font-size: 13px;
}

.reservation-list {
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.reservation-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  border: 1px solid #f0f0f0;
  border-radius: 10px;
  padding: 10px 12px;
}
.reservation-title {
  font-weight: 700;
  color: #333;
}
.reservation-time {
  font-size: 12px;
  color: #666;
  margin-top: 2px;
}
.reservation-main {
  display: flex;
  flex-direction: column;
}
.empty {
  color: #888;
  font-size: 13px;
}

@media (max-width: 768px) {
  .room-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

/* å“åº”å¼é€‚é…ï¼ˆå°å±å¹•ä¼˜åŒ–ï¼‰ */
@media (max-width: 768px) {
  .library-modal {
    width: 95%;
    max-height: 90vh;
  }

  .modal-header h2 {
    font-size: 18px;
  }

  .data-cards {
    flex-direction: column;
  }

  .data-card {
    min-width: auto;
  }

  .modal-footer {
    flex-direction: column;
  }

  .chart-item {
    padding: 12px;
  }

  .chart-canvas {
    height: 200px;
  }

  .charts-container {
    gap: 15px;
  }

  .tab-item {
    font-size: 13px;
    padding: 8px 0;
  }
}
</style>
