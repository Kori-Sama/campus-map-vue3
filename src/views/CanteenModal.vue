<template>
    <div v-if="show" class="canteen-modal-overlay" @click="closeModal">
        <div class="canteen-modal" @click.stop>
            <button class="modal-close" @click="closeModal">âœ•</button>

            <div class="modal-header">
                <h2>ğŸ½ï¸ è¥¿å—äº¤é€šå¤§å­¦é£Ÿå ‚</h2>
                <div class="tab-container">
                    <div class="tab-item" :class="{ active: activeTab === 'rules' }" @click="handleTabSwitch('rules')">
                        é£Ÿå ‚ä½¿ç”¨è§„åˆ™
                    </div>
                    <div class="tab-item" :class="{ active: activeTab === 'data' }" @click="handleTabSwitch('data')">
                        æ•°æ®å¯è§†åŒ–å¤§å±
                    </div>
                </div>
            </div>

            <div class="modal-body">
                <!-- ä½¿ç”¨è§„åˆ™ -->
                <div v-if="activeTab === 'rules'">
                    <div class="info-section">
                        <h3>åŸºæœ¬ä¿¡æ¯</h3>
                        <div class="info-item">
                            <span class="label">ğŸ“ ä½ç½®ï¼š</span>
                            <span>æ ¡å›­ä¸­å¿ƒåŒºï¼ˆè¿‘ç¬¬ä¸€æ•™å­¦æ¥¼ï¼Œä»åŒ—é—¨æ­¥è¡Œçº¦5åˆ†é’Ÿï¼‰</span>
                        </div>
                        <div class="info-item">
                            <span class="label">â° è¥ä¸šæ—¶é—´ï¼š</span>
                            <span>æ—©é¤ 7:00-9:00 | åˆé¤ 11:00-14:00 | æ™šé¤ 17:00-20:00</span>
                        </div>
                        <div class="info-item">
                            <span class="label">ğŸ“ è”ç³»ç”µè¯ï¼š</span>
                            <span>æœåŠ¡å° 028-66367777 | æŠ•è¯‰å»ºè®® 028-66367788</span>
                        </div>
                    </div>

                    <div class="info-section">
                        <h3>å°±é¤è§„åˆ™</h3>
                        <ul class="facilities-list">
                            <li>ğŸ¥— åˆ·å¡å…¥åœºï¼šæŒæ ¡å›­å¡åˆ·å¡è¿›å…¥ï¼Œä¿æŒç§©åºæ’é˜Ÿ</li>
                            <li>ğŸ´ è‡ªå¸¦é¤å…·ï¼šé¼“åŠ±è‡ªå¸¦é¤å…·ï¼Œå‡å°‘ä¸€æ¬¡æ€§ç”¨å“</li>
                            <li>ğŸš« å ä½é™åˆ¶ï¼šç¦æ­¢å åº§ç”¨é¤å®Œæ¯•ååŠæ—¶ç¦»å¼€</li>
                            <li>âš ï¸ é£Ÿç‰©å®‰å…¨ï¼šé£Ÿå“ä¿è´¨æœŸå†…ï¼Œç¦æ­¢æºå¸¦å¤–å–å…¥å†…</li>
                            <li>ğŸ§¹ ç¯å¢ƒç»´æŠ¤ï¼šå°±é¤åè¯·å°†é¤ç›˜æ”¾å›å›æ”¶å°ï¼Œä¿æŒç¯å¢ƒå«ç”Ÿ</li>
                        </ul>
                    </div>

                    <div class="info-section">
                        <h3>é¤å…è®¾æ–½</h3>
                        <ul class="facilities-list">
                            <li>ğŸ½ï¸ ä¸»é£ŸåŒºï¼šæä¾›ç±³é¥­ã€é¢æ¡ã€é¦’å¤´ç­‰åŸºç¡€ä¸»é£Ÿ</li>
                            <li>ğŸ¥˜ çƒ­èœåŒºï¼šå·¥ç§‘æ¥¼é£Ÿå ‚ä¾›åº”20+æ¬¾çƒ­èœï¼ŒæŒ‰é¤æ¬¡è½®æ¢</li>
                            <li>ğŸ¥— å°åƒåŒºï¼šæ²™æ‹‰ã€å‡‰èœã€æ°´æœä¾›åº”</li>
                            <li>â˜• é¥®å“åŒºï¼šè±†æµ†ã€å’–å•¡ã€å¥¶èŒ¶ç­‰</li>
                            <li>ğŸ’» è‡ªä¹ åŒºï¼šé¤å…äºŒæ¥¼éƒ¨åˆ†åŒºåŸŸæä¾›åº§ä½å¯ç”¨ä½œä¸´æ—¶å­¦ä¹ </li>
                        </ul>
                    </div>

                    <div class="info-section">
                        <h3>äº¤é€šæŒ‡å¼•</h3>
                        <p>
                            æ ¡å†…è·¯çº¿ï¼šä»æ ¡å¤§é—¨æ­¥è¡Œçº¦10åˆ†é’Ÿå³å¯åˆ°é£Ÿå ‚ï¼›å„æ•™å­¦æ¥¼è‡³é£Ÿå ‚æœ‰æ˜æ˜¾æŒ‡ç¤ºç‰Œã€‚<br>
                            æ ¡å¤–è·¯çº¿ï¼šåœ°é“2å·çº¿ã€Œäº¤å¤§ç«™ã€Då£å‡ºï¼Œæ­¥è¡Œ12åˆ†é’Ÿè‡³æ ¡å›­ä¸œé—¨ï¼Œè¿›å…¥åç›´è¡Œ500ç±³ï¼›è‡ªé©¾å¯åœè‡³é£Ÿå ‚åœ°ä¸‹åœè½¦åœºï¼ˆå‡­æ ¡å›­å¡å…è´¹1å°æ—¶ï¼‰ã€‚
                        </p>
                    </div>
                </div>

                <!-- å¤§å±æ•°æ®å¯è§†åŒ– -->
                <div v-if="activeTab === 'data'" class="data-visual-section">
                    <div class="data-cards">
                        <div class="data-card">
                            <div class="data-title">ä»Šæ—¥å°±é¤äººæ•°</div>
                            <div class="data-value">{{ todayVisitors }}</div>
                            <div class="data-trend up">â†‘10% è¾ƒæ˜¨æ—¥</div>
                        </div>
                        <div class="data-card">
                            <div class="data-title">å½“å‰åœ¨é¤äººæ•°</div>
                            <div class="data-value">{{ currentVisitors }}</div>
                            <div class="data-trend down">â†“5% è¾ƒä¸Šå°æ—¶</div>
                        </div>
                        <div class="data-card">
                            <div class="data-title">ä»Šæ—¥é”€å”®é¢</div>
                            <div class="data-value">Â¥{{ todayRevenue }}</div>
                            <div class="data-trend up">â†‘8% è¾ƒæ˜¨æ—¥</div>
                        </div>
                        <div class="data-card">
                            <div class="data-title">é¤æ¡Œä½¿ç”¨ç‡</div>
                            <div class="data-value">{{ tableUsage }}%</div>
                            <div class="data-trend up">â†‘12% è¾ƒä¸Šå‘¨</div>
                        </div>
                    </div>

                    <div class="chart-tabs">
                        <button class="chart-tab-btn" :class="{ active: currentChart === 'line' }"
                            @click="switchChart('line')">
                            ğŸ“ˆ é¤æ¡Œä½¿ç”¨ç‡
                        </button>
                        <button class="chart-tab-btn" :class="{ active: currentChart === 'pie' }"
                            @click="switchChart('pie')">
                            ğŸ± èœå“åˆ†ç±»é”€å”®
                        </button>
                        <button class="chart-tab-btn" :class="{ active: currentChart === 'bar' }"
                            @click="switchChart('bar')">
                            â° å°±é¤é«˜å³°æ—¶æ®µ
                        </button>
                        <button class="chart-tab-btn" :class="{ active: currentChart === 'wordCloud' }"
                            @click="switchChart('wordCloud')">
                            â˜ï¸ çƒ­é—¨èœå“
                        </button>
                    </div>

                    <div class="charts-container">
                        <div v-show="currentChart === 'line'" class="chart-item">
                            <h4>ğŸ“ˆ è¿‘7å¤©é¤æ¡Œä½¿ç”¨ç‡è¶‹åŠ¿</h4>
                            <div ref="lineChart" class="chart-canvas"></div>
                        </div>
                        <div v-show="currentChart === 'pie'" class="chart-item">
                            <h4>ğŸ± èœå“åˆ†ç±»é”€å”®å æ¯”</h4>
                            <div ref="pieChart" class="chart-canvas"></div>
                        </div>
                        <div v-show="currentChart === 'bar'" class="chart-item">
                            <h4>â° æ¯æ—¥å°±é¤é«˜å³°æ—¶æ®µ</h4>
                            <div ref="barChart" class="chart-canvas"></div>
                        </div>
                        <div v-show="currentChart === 'wordCloud'" class="chart-item">
                            <h4>â˜ï¸ çƒ­é—¨èœå“å…³é”®è¯</h4>
                            <div ref="wordCloudChart" class="chart-canvas"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" @click="closeModal">å…³é—­</button>
                <button class="btn btn-primary" @click="navigateToCanteen">ğŸ—ºï¸ å¯¼èˆªåˆ°æ­¤</button>
                <button class="btn btn-info" @click="openFullScreenData" v-if="activeTab === 'data'">
                    ğŸ“Š æŸ¥çœ‹å®Œæ•´å¤§å±
                </button>
            </div>
        </div>
    </div>
</template>

<script setup>
import { ref, onMounted, watch, nextTick, getCurrentInstance } from 'vue';

const props = defineProps({
    show: Boolean
});
const emit = defineEmits(['close', 'navigate', 'open-full-screen-data']);

const activeTab = ref('rules');
const currentChart = ref('line');

// æ¨¡æ‹Ÿæ•°æ®
const todayVisitors = ref(980);
const currentVisitors = ref(420);
const todayRevenue = ref(15230);
const tableUsage = ref(65);

const lineChart = ref(null);
const pieChart = ref(null);
const barChart = ref(null);
const wordCloudChart = ref(null);

let lineChartInstance = null;
let pieChartInstance = null;
let barChartInstance = null;
let wordCloudChartInstance = null;

const { proxy } = getCurrentInstance();

// æŠ˜çº¿å›¾é…ç½® - é¤æ¡Œä½¿ç”¨ç‡è¶‹åŠ¿
const lineChartOption = ref({
    backgroundColor: 'transparent',
    grid: {
        top: '15%',
        left: '10%',
        right: '10%',
        bottom: '15%'
    },
    xAxis: {
        type: 'category',
        data: ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'],
        axisLine: {
            lineStyle: { color: '#00d4ff' }
        },
        axisLabel: {
            color: '#00d4ff'
        }
    },
    yAxis: {
        type: 'value',
        max: 100,
        axisLine: {
            lineStyle: { color: '#00d4ff' }
        },
        axisLabel: {
            color: '#00d4ff',
            formatter: '{value}%'
        },
        splitLine: {
            lineStyle: { color: 'rgba(0, 212, 255, 0.2)' }
        }
    },
    series: [{
        data: [60, 70, 65, 80, 75, 50, 55],
        type: 'line',
        smooth: true,
        symbol: 'circle',
        symbolSize: 8,
        lineStyle: {
            width: 3,
            color: {
                type: 'linear',
                x: 0, y: 0, x2: 1, y2: 0,
                colorStops: [{
                    offset: 0, color: '#2575fc'
                }, {
                    offset: 1, color: '#00d4ff'
                }]
            }
        },
        itemStyle: {
            color: '#00d4ff',
            shadowColor: '#00d4ff',
            shadowBlur: 10
        },
        areaStyle: {
            color: {
                type: 'linear',
                x: 0, y: 0, x2: 0, y2: 1,
                colorStops: [{
                    offset: 0, color: 'rgba(37, 117, 252, 0.3)'
                }, {
                    offset: 1, color: 'rgba(0, 212, 255, 0.1)'
                }]
            }
        }
    }]
});

// é¥¼å›¾é…ç½® - èœå“åˆ†ç±»é”€å”®å æ¯”
const pieChartOption = ref({
    backgroundColor: 'transparent',
    legend: {
        orient: 'vertical',
        left: '10%',
        top: '20%',
        textStyle: {
            color: '#00d4ff'
        }
    },
    series: [{
        type: 'pie',
        radius: ['40%', '70%'],
        center: ['60%', '50%'],
        data: [
            { name: 'ä¸»é£Ÿç±»', value: 40 },
            { name: 'çƒ­èœç±»', value: 30 },
            { name: 'å‡‰èœç±»', value: 15 },
            { name: 'é¥®å“ç±»', value: 10 },
            { name: 'å…¶ä»–ç±»', value: 5 }
        ],
        emphasis: {
            itemStyle: {
                shadowBlur: 10,
                shadowOffsetX: 0,
                shadowColor: 'rgba(0, 0, 0, 0.5)'
            }
        },
        itemStyle: {
            borderRadius: 8,
            borderColor: '#fff',
            borderWidth: 2
        },
        label: {
            color: '#00d4ff',
            formatter: '{b}: {c}%'
        },
        color: ['#2575fc', '#6a11cb', '#00b42a', '#f53f3f', '#ff7d00']
    }]
});

// æŸ±çŠ¶å›¾é…ç½® - å°±é¤é«˜å³°æ—¶æ®µ
const barChartOption = ref({
    backgroundColor: 'transparent',
    grid: {
        top: '15%',
        left: '15%',
        right: '10%',
        bottom: '20%'
    },
    xAxis: {
        type: 'category',
        data: ['7-9ç‚¹', '9-11ç‚¹', '11-13ç‚¹', '13-15ç‚¹', '15-17ç‚¹', '17-19ç‚¹', '19-21ç‚¹'],
        axisLine: {
            lineStyle: { color: '#00d4ff' }
        },
        axisLabel: {
            color: '#00d4ff',
            rotate: 45
        }
    },
    yAxis: {
        type: 'value',
        axisLine: {
            lineStyle: { color: '#00d4ff' }
        },
        axisLabel: {
            color: '#00d4ff'
        },
        splitLine: {
            lineStyle: { color: 'rgba(0, 212, 255, 0.2)' }
        }
    },
    series: [{
        data: [380, 120, 450, 180, 90, 420, 150],
        type: 'bar',
        barWidth: '60%',
        itemStyle: {
            color: {
                type: 'linear',
                x: 0, y: 0, x2: 0, y2: 1,
                colorStops: [{
                    offset: 0, color: '#00d4ff'
                }, {
                    offset: 1, color: '#2575fc'
                }]
            },
            borderRadius: [4, 4, 0, 0],
            shadowColor: '#2575fc',
            shadowBlur: 10,
            shadowOffsetY: 5
        }
    }]
});

// è¯äº‘å›¾é…ç½® - çƒ­é—¨èœå“å…³é”®è¯
const wordCloudOption = ref({
    backgroundColor: 'transparent',
    series: [{
        type: 'wordCloud',
        shape: 'circle',
        left: 'center',
        top: 'center',
        width: '100%',
        height: '100%',
        right: null,
        bottom: null,
        sizeRange: [14, 60],
        rotationRange: [-45, 45],
        rotationStep: 45,
        gridSize: 8,
        drawOutOfBound: false,
        layoutAnimation: true,
        textStyle: {
            fontFamily: 'Microsoft YaHei, sans-serif',
            fontWeight: 'bold',
            color: function () {
                const colors = [
                    '#2575fc', '#00d4ff', '#6a11cb', '#00b42a',
                    '#f53f3f', '#ff7d00', '#00d4ff', '#9254de'
                ];
                return colors[Math.floor(Math.random() * colors.length)];
            }
        },
        emphasis: {
            focus: 'self',
            textStyle: {
                textShadowBlur: 10,
                textShadowColor: '#00d4ff'
            }
        },
        data: [
            { name: 'éº»è¾£é¦™é”…', value: 1500 },
            { name: 'çº¢çƒ§è‚‰', value: 1200 },
            { name: 'é±¼é¦™è‚‰ä¸', value: 1100 },
            { name: 'å®«ä¿é¸¡ä¸', value: 1000 },
            { name: 'è›‹ç‚’é¥­', value: 950 },
            { name: 'ç•ªèŒ„ç‚’è›‹', value: 900 },
            { name: 'é…¸è¾£åœŸè±†ä¸', value: 850 },
            { name: 'ç‰›è‚‰é¢', value: 800 },
            { name: 'æ‹…æ‹…é¢', value: 750 },
            { name: 'ç…²ä»”é¥­', value: 700 },
            { name: 'ç›–æµ‡é¥­', value: 650 },
            { name: 'éº»å©†è±†è…', value: 600 },
            { name: 'å›é”…è‚‰', value: 550 },
            { name: 'é’æ¤’è‚‰ä¸', value: 500 },
            { name: 'æ°´ç…®é±¼', value: 480 },
            { name: 'æ¯›è¡€æ—º', value: 450 },
            { name: 'ç³–é†‹é‡Œè„Š', value: 420 },
            { name: 'ä¸œå¡è‚‰', value: 400 },
            { name: 'å¯ä¹é¸¡ç¿…', value: 380 },
            { name: 'å°é¾™è™¾', value: 350 },
            { name: 'çƒ¤é±¼', value: 320 },
            { name: 'ç«é”…', value: 300 },
            { name: 'å†’èœ', value: 280 },
            { name: 'ä¸²ä¸²é¦™', value: 260 },
            { name: 'çƒ§çƒ¤', value: 240 }
        ]
    }]
});

// åˆå§‹åŒ–å›¾è¡¨å‡½æ•°
const initCharts = () => {
    if (!lineChart.value || !pieChart.value || !barChart.value || !wordCloudChart.value) return;

    // åˆå§‹åŒ–æŠ˜çº¿å›¾
    lineChartInstance = proxy.$echarts.init(lineChart.value);
    lineChartInstance.setOption(lineChartOption.value);

    // åˆå§‹åŒ–é¥¼å›¾
    pieChartInstance = proxy.$echarts.init(pieChart.value);
    pieChartInstance.setOption(pieChartOption.value);

    // åˆå§‹åŒ–æŸ±çŠ¶å›¾
    barChartInstance = proxy.$echarts.init(barChart.value);
    barChartInstance.setOption(barChartOption.value);

    // åˆå§‹åŒ–è¯äº‘å›¾
    wordCloudChartInstance = proxy.$echarts.init(wordCloudChart.value);
    wordCloudChartInstance.setOption(wordCloudOption.value);
};

const handleTabSwitch = (tab) => {
    activeTab.value = tab;
    if (tab === 'data') {
        nextTick(initCharts);
    }
};

const switchChart = (chartType) => {
    currentChart.value = chartType;
    nextTick(() => {
        if (chartType === 'line') lineChartInstance?.resize();
        if (chartType === 'pie') pieChartInstance?.resize();
        if (chartType === 'bar') barChartInstance?.resize();
        if (chartType === 'wordCloud') wordCloudChartInstance?.resize();
    });
};

watch(() => props.show, (val) => {
    if (val && activeTab.value === 'data') nextTick(initCharts);
});

const closeModal = () => emit('close');
const navigateToCanteen = () => emit('navigate');

const openFullScreenData = () => {
    // åˆ›å»ºå…¨å±æ•°æ®å¯è§†åŒ–é¡µé¢
    const fullScreenWindow = window.open('', '_blank', 'width=1920,height=1080');
    const fullScreenContent = `
    <!DOCTYPE html>
    <html lang="zh-CN">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>è¥¿å—äº¤é€šå¤§å­¦é£Ÿå ‚ - æ•°æ®å¯è§†åŒ–å¤§å±</title>
        <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"><\/script>
        <script src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2.1.0/dist/echarts-wordcloud.min.js"><\/script>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
    font-family: 'Microsoft YaHei', sans-serif;
    overflow: hidden;
    height: 100vh;
}

.fullscreen-container {
    width: 100vw;
    height: 100vh;
    padding: 15px;
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.header {
    text-align: center;
    color: #00d4ff;
    font-size: 28px;
    font-weight: bold;
    text-shadow: 0 0 20px rgba(0, 212, 255, 0.8);
    flex-shrink: 0;
}

.data-overview {
    display: flex;
    gap: 15px;
    height: 100px;
    flex-shrink: 0;
}

.data-card {
    flex: 1;
    background: linear-gradient(135deg, rgba(37, 117, 252, 0.2), rgba(106, 17, 203, 0.2));
    border: 2px solid rgba(37, 117, 252, 0.5);
    border-radius: 12px;
    padding: 12px;
    text-align: center;
    backdrop-filter: blur(10px);
    box-shadow: 0 8px 32px rgba(37, 117, 252, 0.3);
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.data-title {
    color: #00d4ff;
    font-size: 14px;
    margin-bottom: 5px;
    text-shadow: 0 0 10px rgba(0, 212, 255, 0.6);
}

.data-value {
    color: #ffffff;
    font-size: 32px;
    font-weight: bold;
    text-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
}

.charts-area {
    flex: 1;
    min-height: 0;
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    grid-template-rows: repeat(2, 1fr);
    gap: 15px;
}

.chart-container {
    background: linear-gradient(135deg, rgba(26, 26, 46, 0.8), rgba(22, 33, 62, 0.8));
    border: 2px solid rgba(37, 117, 252, 0.4);
    border-radius: 12px;
    padding: 12px;
    backdrop-filter: blur(10px);
    display: flex;
    flex-direction: column;
    min-height: 0;
    overflow: hidden;
}

.chart-title {
    color: #00d4ff;
    font-size: 16px;
    text-align: center;
    margin-bottom: 8px;
    text-shadow: 0 0 10px rgba(0, 212, 255, 0.6);
    flex-shrink: 0;
}

.chart-canvas {
    flex: 1;
    min-height: 0;
    width: 100%;
    height: 100%;
}
</style>
</head>

<body>
    <div class="fullscreen-container">
        <div class="header">
            ğŸ½ï¸ è¥¿å—äº¤é€šå¤§å­¦é£Ÿå ‚ - æ•°æ®å¯è§†åŒ–å¤§å±
        </div>
        <div class="data-overview">
            <div class="data-card">
                <div class="data-title">ä»Šæ—¥å°±é¤äººæ•°</div>
                <div class="data-value">${todayVisitors.value}</div>
            </div>
            <div class="data-card">
                <div class="data-title">å½“å‰åœ¨é¤äººæ•°</div>
                <div class="data-value">${currentVisitors.value}</div>
            </div>
            <div class="data-card">
                <div class="data-title">ä»Šæ—¥é”€å”®é¢</div>
                <div class="data-value">Â¥${todayRevenue.value}</div>
            </div>
            <div class="data-card">
                <div class="data-title">é¤æ¡Œä½¿ç”¨ç‡</div>
                <div class="data-value">${tableUsage.value}%</div>
            </div>
        </div>
        <div class="charts-area">
            <div class="chart-container">
                <div class="chart-title">ğŸ“ˆ è¿‘7å¤©é¤æ¡Œä½¿ç”¨ç‡è¶‹åŠ¿</div>
                <div id="lineChart" class="chart-canvas"></div>
            </div>
            <div class="chart-container">
                <div class="chart-title">ğŸ± èœå“åˆ†ç±»é”€å”®å æ¯”</div>
                <div id="pieChart" class="chart-canvas"></div>
            </div>
            <div class="chart-container">
                <div class="chart-title">â° æ¯æ—¥å°±é¤é«˜å³°æ—¶æ®µ</div>
                <div id="barChart" class="chart-canvas"></div>
            </div>
            <div class="chart-container">
                <div class="chart-title">â˜ï¸ çƒ­é—¨èœå“å…³é”®è¯</div>
                <div id="wordCloudChart" class="chart-canvas"></div>
            </div>
        </div>
    </div>
    <script>
            // åˆå§‹åŒ–å›¾è¡¨
            window.onload = function() {
                // æŠ˜çº¿å›¾
                const lineChart = echarts.init(document.getElementById('lineChart'));
                lineChart.setOption(${JSON.stringify(lineChartOption.value)});
                
                // é¥¼å›¾
                const pieChart = echarts.init(document.getElementById('pieChart'));
                pieChart.setOption(${JSON.stringify(pieChartOption.value)});
                
                // æŸ±çŠ¶å›¾
                const barChart = echarts.init(document.getElementById('barChart'));
                barChart.setOption(${JSON.stringify(barChartOption.value)});
                
                // è¯äº‘å›¾
                const wordCloudChart = echarts.init(document.getElementById('wordCloudChart'));
                wordCloudChart.setOption(${JSON.stringify(wordCloudOption.value)});
                
                // è‡ªé€‚åº”çª—å£å¤§å°
                window.addEventListener('resize', function() {
                    lineChart.resize();
                    pieChart.resize();
                    barChart.resize();
                    wordCloudChart.resize();
                });
            };
        <\/script>
</body>

</html>
`;
    fullScreenWindow.document.write(fullScreenContent);
    fullScreenWindow.document.close();
};
</script>

<style scoped>
/* æ ·å¼å®Œå…¨ä»¿ç…§å›¾ä¹¦é¦† */
.canteen-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.4);
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(2px);
    z-index: 11000;
}

.canteen-modal {
    background: white;
    border-radius: 16px;
    width: 90%;
    max-width: 900px;
    max-height: 85vh;
    overflow-y: auto;
    position: relative;
    animation: slideIn 0.3s ease-out;
}

.modal-close {
    position: absolute;
    top: 16px;
    right: 16px;
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #999;
    padding: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
    transition: color 0.18s;
}

.modal-close:hover {
    color: #333;
}

.modal-header {
    padding: 24px 24px 16px;
    border-bottom: 2px solid #f0f0f0;
}

.modal-header h2 {
    margin: 0 0 16px 0;
    font-size: 22px;
    font-weight: 700;
    color: #333;
}

.tab-container {
    display: flex;
    border-radius: 8px;
    overflow: hidden;
    background: #f5f5f5;
    margin-top: 8px;
}

.tab-item {
    flex: 1;
    text-align: center;
    padding: 10px 0;
    font-size: 14px;
    font-weight: 600;
    color: #666;
    cursor: pointer;
    transition: all 0.2s;
}

.tab-item.active {
    background: #2575fc;
    color: white;
}

.modal-body {
    padding: 24px;
}

.info-section {
    margin-bottom: 20px;
}

.info-section h3 {
    margin: 0 0 12px 0;
    font-size: 14px;
    font-weight: 700;
    color: #2575fc;
    border-bottom: 2px solid #2575fc;
    padding-bottom: 6px;
}

.info-item {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
    font-size: 14px;
    color: #333;
}

.label {
    font-weight: 600;
    margin-right: 8px;
    color: #555;
}

.facilities-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.facilities-list li {
    padding: 8px 0;
    font-size: 14px;
    color: #555;
    border-bottom: 1px solid #f0f0f0;
}

.facilities-list li:last-child {
    border-bottom: none;
}

.modal-footer {
    display: flex;
    gap: 12px;
    padding: 16px 24px;
    border-top: 1px solid #f0f0f0;
    background: #f9f9f9;
    border-radius: 0 0 16px 16px;
}

.btn {
    flex: 1;
    padding: 12px 16px;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.18s;
}

.btn-secondary {
    background: #e0e0e0;
    color: #333;
}

.btn-primary {
    background: linear-gradient(90deg, #2575fc, #0d47a1);
    color: white;
}

.btn-info {
    background: linear-gradient(90deg, #6a11cb, #2575fc);
    color: white;
}

.data-visual-section {
    display: flex;
    flex-direction: column;
    gap: 20px;
    background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
    border-radius: 12px;
    padding: 20px;
    margin: -24px;
    margin-top: 0;
}

.data-cards {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
}

.data-card {
    flex: 1;
    min-width: 160px;
    background: linear-gradient(135deg, rgba(37, 117, 252, 0.1), rgba(106, 17, 203, 0.1));
    border: 1px solid rgba(37, 117, 252, 0.3);
    border-radius: 12px;
    padding: 16px;
    box-shadow: 0 4px 15px rgba(37, 117, 252, 0.2);
    backdrop-filter: blur(10px);
}

.data-title {
    font-size: 14px;
    color: #00d4ff;
    margin-bottom: 8px;
}

.data-value {
    font-size: 28px;
    font-weight: 700;
    color: #fff;
    margin-bottom: 4px;
}

.data-trend.up {
    color: #00ff88;
}

.data-trend.down {
    color: #ff4757;
}

.chart-tabs {
    display: flex;
    gap: 12px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.chart-tab-btn {
    flex: 1;
    min-width: 120px;
    padding: 12px 16px;
    background: linear-gradient(135deg, rgba(37, 117, 252, 0.15), rgba(106, 17, 203, 0.15));
    border: 1px solid rgba(37, 117, 252, 0.3);
    border-radius: 10px;
    color: #00d4ff;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    text-shadow: 0 0 5px rgba(0, 212, 255, 0.3);
}

.chart-tab-btn.active {
    background: linear-gradient(135deg, #2575fc, #6a11cb);
    color: white;
    border-color: #2575fc;
}

.charts-container {
    display: flex;
    flex-direction: column;
    min-height: 400px;
}

.chart-item {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    border-radius: 12px;
    padding: 0;
    box-shadow: 0 4px 15px rgba(37, 117, 252, 0.2);
    border: 1px solid rgba(37, 117, 252, 0.3);
    overflow: hidden;
}

.chart-item h4 {
    margin: 0;
    font-size: 16px;
    color: #00d4ff;
    font-weight: 600;
    text-align: center;
    padding: 15px;
    background: rgba(0, 212, 255, 0.1);
    border-bottom: 1px solid rgba(0, 212, 255, 0.3);
}

.chart-canvas {
    width: 100%;
    height: 280px;
}
</style>
